<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Devan Becker">
<meta name="dcterms.date" content="2024-05-13">

<title>STAR Notes – 3&nbsp; Assessing Fit</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./L04-Matrix_Form.html" rel="next">
<link href="./L02-Fitting_Straight_Lines.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./L01-Introduction.html">OLS Basics</a></li><li class="breadcrumb-item"><a href="./L03-Residuals.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Assessing Fit</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">STAR Notes</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">OLS Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L01-Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Statistics Review</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L02-Fitting_Straight_Lines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fitting Straight Lines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L03-Residuals.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Assessing Fit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L04-Matrix_Form.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regression in Matrix Form</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L05-General_Regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The General Regression Situation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L06-Extra_Sums_of_Squares.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Extra Sum-of-Squares</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L07-Exampless.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">ESS Exampless</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L08-Hat-Resid_Plots-Cook.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">The Hat Matrix</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L09-Analysing-Resids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The Hat Matrix 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L10-Extra_Topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Special Topics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L11-Wrong_Model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Getting the Wrong Model</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Choosing Models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L12-NonLinear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Non-Linear Relationships with Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L13-Transforming_Response.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Transformations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L14-Modelling_Transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Modelling with Transformations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L15-Multicollinearity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Multicollinearity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L16-Dummies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Dummy Variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L17-Example_Analysis_mtcars.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Analysis of MTCars</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L18-Modelling_Poorly.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Modelling Poorly</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L19-Regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Regularization Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L20-Logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L21-Logistic_Example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Logistic Modelling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Review</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L22-Review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Final Exam Review</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lb02-OLS_Estimates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">OLS Estimates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lb03-MSE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Bias/variance of <span class="math inline">\(\sigma^2\)</span></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lb04-R_Matrix_Form.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Verifying Matrix Identities</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lb05-ANOVA-R2-F_test-CI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">ANOVA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lb11-R_hat_resids_cook.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Hat Matrix and Residuals in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lb12-Corr_in_Betas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Extra Topics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lb13-Wrong_Model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Lab Missing/Extra Predictors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lb15-Transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Transformations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lb16-Regression_with_Dummies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Regression with Categorical Predictors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lb17-Multico.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Multicollinearity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lb18-Backwards_Selection_is_Bad.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Backwards p-values</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lb19-Permutation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Permutation Tests</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#analysis-of-variance" id="toc-analysis-of-variance" class="nav-link active" data-scroll-target="#analysis-of-variance"><span class="header-section-number">3.1</span> Analysis of Variance</a>
  <ul class="collapse">
  <li><a href="#statistics-is-the-study-of-variance" id="toc-statistics-is-the-study-of-variance" class="nav-link" data-scroll-target="#statistics-is-the-study-of-variance">Statistics is the Study of Variance</a></li>
  <li><a href="#a-useful-identity-and-its-interpretations" id="toc-a-useful-identity-and-its-interpretations" class="nav-link" data-scroll-target="#a-useful-identity-and-its-interpretations">A Useful Identity, and its Interpretations</a></li>
  <li><a href="#sums-of-squares" id="toc-sums-of-squares" class="nav-link" data-scroll-target="#sums-of-squares">Sums of Squares</a></li>
  <li><a href="#aside-degrees-of-freedom" id="toc-aside-degrees-of-freedom" class="nav-link" data-scroll-target="#aside-degrees-of-freedom">Aside: Degrees of Freedom</a></li>
  <li><a href="#sums-of-squares-in-an-anova-table" id="toc-sums-of-squares-in-an-anova-table" class="nav-link" data-scroll-target="#sums-of-squares-in-an-anova-table">Sums of Squares in an ANOVA Table</a></li>
  <li><a href="#using-sumsmeans-of-squares" id="toc-using-sumsmeans-of-squares" class="nav-link" data-scroll-target="#using-sumsmeans-of-squares">Using Sums/Means of Squares</a></li>
  <li><a href="#the-f-test-for-significance-of-regression" id="toc-the-f-test-for-significance-of-regression" class="nav-link" data-scroll-target="#the-f-test-for-significance-of-regression">The F-test for Significance of Regression</a></li>
  <li><a href="#exercise-a-from-chapter-3-ch03-exercises-cover-ch1-3" id="toc-exercise-a-from-chapter-3-ch03-exercises-cover-ch1-3" class="nav-link" data-scroll-target="#exercise-a-from-chapter-3-ch03-exercises-cover-ch1-3">Exercise A from Chapter 3 (Ch03 Exercises cover Ch1-3)</a></li>
  </ul></li>
  <li><a href="#rule-number-1-always-plot-everything" id="toc-rule-number-1-always-plot-everything" class="nav-link" data-scroll-target="#rule-number-1-always-plot-everything"><span class="header-section-number">3.2</span> Rule Number 1: Always Plot Everything</a>
  <ul class="collapse">
  <li><a href="#anscombes-quartet" id="toc-anscombes-quartet" class="nav-link" data-scroll-target="#anscombes-quartet">Anscombe’s Quartet</a></li>
  <li><a href="#anscombes-quartet-1" id="toc-anscombes-quartet-1" class="nav-link" data-scroll-target="#anscombes-quartet-1">Anscombe’s Quartet</a></li>
  </ul></li>
  <li><a href="#the-residual-whats-left-over" id="toc-the-residual-whats-left-over" class="nav-link" data-scroll-target="#the-residual-whats-left-over"><span class="header-section-number">3.3</span> The residual: what’s left over</a>
  <ul class="collapse">
  <li><a href="#r2-percent-of-variance-explained-by-the-regression-model" id="toc-r2-percent-of-variance-explained-by-the-regression-model" class="nav-link" data-scroll-target="#r2-percent-of-variance-explained-by-the-regression-model"><span class="math inline">\(R^2\)</span>: percent of variance explained by the regression model</a></li>
  <li><a href="#residual-assumptions" id="toc-residual-assumptions" class="nav-link" data-scroll-target="#residual-assumptions">Residual Assumptions</a></li>
  <li><a href="#residuals-versus-fitted-values-hatunderlineepsilon-versus-hatunderliney" id="toc-residuals-versus-fitted-values-hatunderlineepsilon-versus-hatunderliney" class="nav-link" data-scroll-target="#residuals-versus-fitted-values-hatunderlineepsilon-versus-hatunderliney">Residuals versus <em>fitted</em> values: <span class="math inline">\(\hat{\underline\epsilon}\)</span> versus <span class="math inline">\(\hat{\underline{y}}\)</span></a></li>
  <li><a href="#residual-plots-and-assumption-checking" id="toc-residual-plots-and-assumption-checking" class="nav-link" data-scroll-target="#residual-plots-and-assumption-checking">Residual Plots and Assumption Checking</a></li>
  <li><a href="#residual-plots-unstable-error-a.k.a.-heteroscedasticity" id="toc-residual-plots-unstable-error-a.k.a.-heteroscedasticity" class="nav-link" data-scroll-target="#residual-plots-unstable-error-a.k.a.-heteroscedasticity">Residual plots: unstable error, a.k.a. Heteroscedasticity</a></li>
  <li><a href="#residual-plots-non-linear-trend" id="toc-residual-plots-non-linear-trend" class="nav-link" data-scroll-target="#residual-plots-non-linear-trend">Residual plots: non-linear trend?</a></li>
  <li><a href="#testing-normality-quantile-quantile-plots" id="toc-testing-normality-quantile-quantile-plots" class="nav-link" data-scroll-target="#testing-normality-quantile-quantile-plots">Testing Normality: Quantile-Quantile Plots</a></li>
  <li><a href="#other-residual-plots" id="toc-other-residual-plots" class="nav-link" data-scroll-target="#other-residual-plots">Other Residual Plots:</a></li>
  </ul></li>
  <li><a href="#maximum-likelihood" id="toc-maximum-likelihood" class="nav-link" data-scroll-target="#maximum-likelihood"><span class="header-section-number">3.4</span> Maximum Likelihood</a>
  <ul class="collapse">
  <li><a href="#main-idea" id="toc-main-idea" class="nav-link" data-scroll-target="#main-idea">Main Idea</a></li>
  <li><a href="#the-likelihood" id="toc-the-likelihood" class="nav-link" data-scroll-target="#the-likelihood">The Likelihood</a></li>
  <li><a href="#simple-coin-flip-example" id="toc-simple-coin-flip-example" class="nav-link" data-scroll-target="#simple-coin-flip-example">Simple Coin Flip Example</a></li>
  <li><a href="#maximizing-the-likelihood-in-lm" id="toc-maximizing-the-likelihood-in-lm" class="nav-link" data-scroll-target="#maximizing-the-likelihood-in-lm">Maximizing the Likelihood in LM</a></li>
  <li><a href="#interpreting-the-mse" id="toc-interpreting-the-mse" class="nav-link" data-scroll-target="#interpreting-the-mse">Interpreting the MSE</a></li>
  <li><a href="#compare-to-previous-studies" id="toc-compare-to-previous-studies" class="nav-link" data-scroll-target="#compare-to-previous-studies">Compare to Previous Studies</a></li>
  <li><a href="#compare-to-other-models" id="toc-compare-to-other-models" class="nav-link" data-scroll-target="#compare-to-other-models">Compare to other models</a></li>
  <li><a href="#mse-of-a-parameter-bias-of-s2" id="toc-mse-of-a-parameter-bias-of-s2" class="nav-link" data-scroll-target="#mse-of-a-parameter-bias-of-s2">MSE of a Parameter: Bias of <span class="math inline">\(s^2\)</span></a></li>
  <li><a href="#mse-of-a-parameter-bias-of-s" id="toc-mse-of-a-parameter-bias-of-s" class="nav-link" data-scroll-target="#mse-of-a-parameter-bias-of-s">MSE of a Parameter: Bias of <span class="math inline">\(s\)</span></a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">3.5</span> Exercises</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./L01-Introduction.html">OLS Basics</a></li><li class="breadcrumb-item"><a href="./L03-Residuals.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Assessing Fit</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Assessing Fit</span></h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Dr.&nbsp;Devan Becker </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Jam: <strong>Left Overs</strong> by Joe Bonamassa
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2024-05-13</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="analysis-of-variance" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="analysis-of-variance"><span class="header-section-number">3.1</span> Analysis of Variance</h2>
<section id="statistics-is-the-study-of-variance" class="level3">
<h3 class="anchored" data-anchor-id="statistics-is-the-study-of-variance">Statistics is the Study of Variance</h3>
<ul>
<li>Given a data set with variable <span class="math inline">\(\underline y\)</span>, <span class="math inline">\(V(\underline y) = \sigma^2_y\)</span>.
<ul>
<li>This is just the variance of a single variable.</li>
</ul></li>
<li>Once we’ve incorporated the linear relationship with <span class="math inline">\(\underline x\)</span>, <span class="math inline">\(V(\hat\beta \underline x + \underline\epsilon)=0+V(\underline\epsilon) = \sigma^2\)</span>
<ul>
<li>Mathematically, <span class="math inline">\(\sigma^2 \le \sigma_y^2\)</span>.
<ul>
<li>Homework: when are they equal?</li>
</ul></li>
</ul></li>
</ul>
<p>The variance in <span class="math inline">\(Y\)</span> is <strong>explained</strong> by <span class="math inline">\(X\)</span>!</p>
<p>This intuition is going to be very important: there’s variance in <span class="math inline">\(y\)</span>, but incorporating <span class="math inline">\(x\)</span> <em>explains</em> some of that variability. Instead of variance around the mean of <span class="math inline">\(y\)</span>, we’re looking at the variance around the line.</p>
<p>Why is <span class="math inline">\(\sigma^2 &lt; \sigma^2_y\)</span>? Imagine a horizontal line at <span class="math inline">\(\bar y\)</span> (also show that <span class="math inline">\(\hat\beta_0 = \bar y\)</span> is the least squares estimator of the model <span class="math inline">\(y_i = \beta_0 + \epsilon\)</span>). The variance above and below the line is simply the variance of <span class="math inline">\(y\)</span>, <em>i.e.</em> <span class="math inline">\(\sigma^2_y\)</span>. This is the absolute worst case scenario. If that line is moved to fit the data as well as possible, then the variance above and below the line will be smaller!</p>
</section>
<section id="a-useful-identity-and-its-interpretations" class="level3">
<h3 class="anchored" data-anchor-id="a-useful-identity-and-its-interpretations">A Useful Identity, and its Interpretations</h3>
<p><span class="math display">\[\begin{align*}
\hat\epsilon_i &amp;= y_i - \hat y_i \\&amp;= y_i - \bar y - (\hat y_i - \bar y)\\
\implies ... \implies \sum_{i=1}^n\hat\epsilon_i^2 &amp;= \sum_{i=1}^n(y_i-\bar y)^2 - \sum_{i=1}^n(\hat y_i - \bar y)^2
\end{align*}\]</span> where we’ve simply added and subtracted <span class="math inline">\(\bar y\)</span>. The final line skips a few steps (try them yourself, or see textbook page 28)!</p>
<p>Note that the “…” is actually fairly difficult to prove. You will need to plug in the least squares estimates <span class="math inline">\(\hat\beta_0\)</span> and <span class="math inline">\(\hat\beta_1\)</span> in order to get to the final answer.</p>
<p>The last line is often written as: <span class="math inline">\(SS_E = SS_T - SS_{Reg}\)</span>.</p>
</section>
<section id="sums-of-squares" class="level3">
<h3 class="anchored" data-anchor-id="sums-of-squares">Sums of Squares</h3>
<p><span class="math display">\[
SS_E = SS_T - SS_{Reg}
\]</span></p>
<ul>
<li><span class="math inline">\(SS_E\)</span>: Sum of Squared Errors</li>
<li><span class="math inline">\(SS_T\)</span>: Sum of Squares Total (i.e., without considering <span class="math inline">\(\underline x\)</span>)</li>
<li><span class="math inline">\(SS_{Reg}\)</span>: Sum of Squares due to the regression.
<ul>
<li>It’s the variance of the line (calculated at observed <span class="math inline">\(\underline x\)</span> values) around the mean of <span class="math inline">\(\underline y\)</span>???
<ul>
<li>This is incredibly useful, but weird.</li>
</ul></li>
<li>I use <span class="math inline">\(SS_{Reg}\)</span> instead of <span class="math inline">\(SS_R\)</span>
<ul>
<li>Some textbooks use <span class="math inline">\(SS_R\)</span> as SS <em>Residuals</em> (same as <span class="math inline">\(SS_E\)</span>), which is confusing.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="aside-degrees-of-freedom" class="level3">
<h3 class="anchored" data-anchor-id="aside-degrees-of-freedom">Aside: Degrees of Freedom</h3>
<p>Def: The number of “pieces of information” from <span class="math inline">\(y_1, y_2, ..., y_n\)</span> to construct a new number.</p>
<ul>
<li>If I have <span class="math inline">\(x = (1,3,2,1,3,???)\)</span> and I know that <span class="math inline">\(\bar x = 2\)</span>, I can recover the missing piece.
<ul>
<li>The mean “uses” (accounts for) one degree of freedom</li>
</ul></li>
<li>If I have <span class="math inline">\(x = (1,2,3,1,???,???)\)</span> and I know <span class="math inline">\(\bar x = 2\)</span> and <span class="math inline">\(s_x^2=1\)</span>, I can recover the <em>two</em> missing pieces.
<ul>
<li>The variance accounts for two degrees of freedom.
<ul>
<li>One <span class="math inline">\(df\)</span> is required to compute it.</li>
</ul></li>
</ul></li>
</ul>
<p>Estimating one parameter takes away one degree of freedom for the rest!</p>
<ul>
<li>Can find <span class="math inline">\(\bar x\)</span> when <span class="math inline">\(x = (1)\)</span>, but can’t find <span class="math inline">\(s_x^2\)</span> because there aren’t enough <span class="math inline">\(df\)</span>!</li>
</ul>
</section>
<section id="sums-of-squares-in-an-anova-table" class="level3">
<h3 class="anchored" data-anchor-id="sums-of-squares-in-an-anova-table">Sums of Squares in an ANOVA Table</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Source of Variation</th>
<th>Degress of Freedom <span class="math inline">\(df\)</span></th>
<th>Sum of Squares (<span class="math inline">\(SS\)</span>)</th>
<th>Mean Square (<span class="math inline">\(MS\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Regression</td>
<td>1</td>
<td><span class="math inline">\(\sum_{i=1}^n(\hat y_i - \bar y)^2\)</span></td>
<td><span class="math inline">\(MS_{Reg}\)</span></td>
</tr>
<tr class="even">
<td>Error</td>
<td><span class="math inline">\(n-2\)</span></td>
<td><span class="math inline">\(\sum_{i=1}^n(y_i - \hat y_i)^2\)</span></td>
<td><span class="math inline">\(MS_E=s^2\)</span></td>
</tr>
<tr class="odd">
<td>Total (corrected)</td>
<td><span class="math inline">\(n-1\)</span></td>
<td><span class="math inline">\(\sum_{i=1}^n(y_i - \bar y)^2\)</span></td>
<td><span class="math inline">\(s_y^2\)</span></td>
</tr>
</tbody>
</table>
<ul>
<li>Notice that <span class="math inline">\(SS_T = SS_{Reg} + SS_E\)</span>, which is also true for the <span class="math inline">\(df\)</span> (but not <span class="math inline">\(MS\)</span>). </li>
<li>Why is <span class="math inline">\(df_E = n-2\)</span>? What two parameters have we estimated?
<ul>
<li><span class="math inline">\(df_{Reg}\)</span> is trickier to explain. It suffices to know that <span class="math inline">\(df_{Reg} = df_T-df_E\)</span>.</li>
</ul></li>
<li>“Corrected”: We estimated the mean of <span class="math inline">\(\underline y\)</span>, rather than just <span class="math inline">\(\sum y_i^2\)</span>.
<ul>
<li>This used a degree of freedom!</li>
</ul></li>
</ul>
</section>
<section id="using-sumsmeans-of-squares" class="level3">
<h3 class="anchored" data-anchor-id="using-sumsmeans-of-squares">Using Sums/Means of Squares</h3>
<ul>
<li>If <span class="math inline">\(\hat y_i = \bar y\)</span> for all <span class="math inline">\(i\)</span>, then we have a horizontal line!
<ul>
<li>That is, there is <em>no relationship</em> between <span class="math inline">\(\underline x\)</span> and <span class="math inline">\(\underline y\)</span>.</li>
<li>In this case, <span class="math inline">\(SS_{reg} = \sum_{i=1}^n(\hat y_i - \bar y)^2 = 0\)</span>.</li>
</ul></li>
</ul>
<p>Okay, so, just test for <span class="math inline">\(SS_{Reg} = 0\)</span>?</p>
<p>But how??? We need some measure of <em>how far from 0</em> is statistically significant!!!</p>
<p>Recall that <span class="math inline">\(SS_E = \sum_{i=1}^n(y_i - \hat y_i)^2\)</span>.</p>
<ul>
<li>We can compare the variation around the line to the variation <em>of</em> the line.
<ul>
<li>This is <span class="math inline">\(MS_{Reg}/MS_E\)</span>, and it follows an <span class="math inline">\(F\)</span> distribution!!</li>
</ul></li>
</ul>
<p>Statistics is the process of adding context to numbers. We expect a model in which there’s no relationship to have an <span class="math inline">\(SS_{Reg}\)</span> of 0. Due to random sampling, we’re never actually going to get this.</p>
<div class="cell" data-hash="L03-Residuals_cache/html/SSReg-sim_67863a05b08e0ad5bfbdcbb0a70a955d">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">50</span>, <span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>ssreg_vals <span class="ot">&lt;-</span> <span class="fu">double</span>(<span class="dv">1000</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># There is no relationship here!</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">+</span> <span class="dv">0</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mylm <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    yhat <span class="ot">&lt;-</span> <span class="fu">predict</span>(mylm)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    ybar <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    ssreg_vals[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>((yhat <span class="sc">-</span> ybar)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ssreg_vals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="L03-Residuals_files/figure-html/SSReg-sim-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ssreg_vals <span class="sc">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>There’s no relationship, but <em>none</em> of the estimated values of <span class="math inline">\(SS_{Reg}\)</span> are 0! Some of them were as high as 80, even though there’s truly no relationship!</p>
<p>So, what value of <span class="math inline">\(SS_{Reg}\)</span> counts as “too large”? We actually don’t test this directly. Because of the way we chose to do statistics, it’s actually quite difficult to create a test at the boundary of possible values (in this case, testing if <span class="math inline">\(SS_{Reg} = 0\)</span> when <span class="math inline">\(SS_{Reg}\)</span> can only be greater than or equal to 0).</p>
</section>
<section id="the-f-test-for-significance-of-regression" class="level3">
<h3 class="anchored" data-anchor-id="the-f-test-for-significance-of-regression">The F-test for Significance of Regression</h3>
<p>The whole point of an ANOVA table is to get down to:</p>
<p><span class="math display">\[
F_{df_{Reg}, df_E} = \dfrac{MS_{Reg}}{MS_E} = \dfrac{MS_{Reg}}{s^2}
\]</span></p>
<ul>
<li>Recall that <span class="math inline">\(SS_{Reg} = SS_T - SS_E\)</span>, but the <span class="math inline">\(df\)</span> make a difference.</li>
<li>For homework, show that <span class="math inline">\(E(MS_{Reg}) = \sigma^2 + \beta_1^2\sum_{i=1}^n(x_i-\bar x)^2\)</span></li>
<li>This implies that <span class="math inline">\(E(MS_{Reg}) &gt; E(MS_E) = \sigma^2\)</span>.
<ul>
<li><strong>UNLESS</strong> <span class="math inline">\(\beta_1 = 0\)</span></li>
</ul></li>
</ul>
</section>
<section id="exercise-a-from-chapter-3-ch03-exercises-cover-ch1-3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-a-from-chapter-3-ch03-exercises-cover-ch1-3">Exercise A from Chapter 3 (Ch03 Exercises cover Ch1-3)</h3>
<div class="columns">
<div class="column" style="width:50%;">
<p>A study was made on the effect of temperature on the yield of a chemical process. The data are shown to the right.</p>
<ol type="1">
<li>Assuming <span class="math inline">\(y_i = \beta_0 + \beta_1x_i + \epsilon_i\)</span>, what are the least squares estimates of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>?</li>
<li>Construct the analysis of variance table and test the hypothesis <span class="math inline">\(H_0: \beta_1=0\)</span> at the 0.05 level.</li>
<li>What are the confidence limits (at <span class="math inline">\(\alpha\)</span> = 0.05) for <span class="math inline">\(\beta_1\)</span>?</li>
</ol>
</div><div class="column" style="width:50%;">
<div class="cell" data-hash="L03-Residuals_cache/html/load-text-data_2549cb4827b3cc26b78695b661fdb83b">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aprean3) <span class="co"># Data from textbook</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dse03a) <span class="co"># Data Set Exercise Ch03A</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   x  y
1 -5  1
2 -4  5
3 -3  4
4 -2  7
5 -1 10
6  0  8</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(dse03a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
</div>
</div>
</div>
<p>Answers:</p>
<div class="cell" data-hash="L03-Residuals_cache/html/aprean_6c2d42eb14d819ffefb8b2c8e19b1990">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> dse03a))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)           x 
   9.272727    1.436364 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> dse03a))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: y
          Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
x          1 226.945  226.94   96.18 4.207e-06 ***
Residuals  9  21.236    2.36                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> dse03a), <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               2.5 %    97.5 %
(Intercept) 8.225007 10.320447
x           1.105045  1.767682</code></pre>
</div>
</div>
<p>As homework, calculate all of these using the formulas in R!</p>
</section>
</section>
<section id="rule-number-1-always-plot-everything" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="rule-number-1-always-plot-everything"><span class="header-section-number">3.2</span> Rule Number 1: Always Plot Everything</h2>
<section id="anscombes-quartet" class="level3">
<h3 class="anchored" data-anchor-id="anscombes-quartet">Anscombe’s Quartet</h3>
<p>Consider the following four data sets</p>
<div class="cell" data-hash="L03-Residuals_cache/html/anscombe1_b64b6f86095ff0dfddbdc39ccf841640">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">data_set</th>
<th style="text-align: right;">xbar</th>
<th style="text-align: right;">sigma_x</th>
<th style="text-align: right;">ybar</th>
<th style="text-align: right;">sigma_y</th>
<th style="text-align: right;">corr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">3.316625</td>
<td style="text-align: right;">7.500909</td>
<td style="text-align: right;">2.031568</td>
<td style="text-align: right;">0.8164205</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">3.316625</td>
<td style="text-align: right;">7.500909</td>
<td style="text-align: right;">2.031657</td>
<td style="text-align: right;">0.8162365</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">3.316625</td>
<td style="text-align: right;">7.500000</td>
<td style="text-align: right;">2.030424</td>
<td style="text-align: right;">0.8162867</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">3.316625</td>
<td style="text-align: right;">7.500909</td>
<td style="text-align: right;">2.030578</td>
<td style="text-align: right;">0.8165214</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Can you guess what the plots look like?</p>
</section>
<section id="anscombes-quartet-1" class="level3">
<h3 class="anchored" data-anchor-id="anscombes-quartet-1">Anscombe’s Quartet</h3>
<div class="cell" data-hash="L03-Residuals_cache/html/anscombe2_66d9eabc9daf28ee6573b73e52d24f2c">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="L03-Residuals_files/figure-html/anscombe2-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-residual-whats-left-over" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="the-residual-whats-left-over"><span class="header-section-number">3.3</span> The residual: what’s left over</h2>
<section id="r2-percent-of-variance-explained-by-the-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="r2-percent-of-variance-explained-by-the-regression-model"><span class="math inline">\(R^2\)</span>: percent of variance explained by the regression model</h3>
<div class="columns">
<div class="column" style="width:30%;">
<p><span class="math display">\[\begin{align*}
R^2 &amp;= \frac{SSReg}{SST}\\&amp; = \frac{S_{XY}^2}{S_{XX}S_{YY}}
\end{align*}\]</span></p>
</div><div class="column" style="width:70%;">
<div class="cell" data-hash="L03-Residuals_cache/html/R2_demo_c127336de43f0c1f5a390452986d63dd">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="at">mat =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">nrow =</span> <span class="dv">1</span>), <span class="at">widths =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">18</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">25</span>, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">25</span>, <span class="dv">2</span> <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>x, <span class="dv">6</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">25</span>), y, <span class="at">xlab =</span> <span class="st">"y"</span>, <span class="at">ylab =</span> <span class="st">"y has variance"</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(y))</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="fu">mean</span>(y), <span class="fu">bquote</span>(<span class="fu">bar</span>(y)), <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">ylab =</span> <span class="st">"There's variance around the line"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(y<span class="sc">~</span>x))</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(y))</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="fu">mean</span>(y), <span class="fu">bquote</span>(<span class="fu">bar</span>(y)), <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>mids <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">lm</span>(y<span class="sc">~</span>x))</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(mids)){</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(<span class="at">x =</span> <span class="fu">rep</span>(x[i], <span class="dv">2</span>), <span class="at">y =</span> <span class="fu">c</span>(y[i], mids[i]), <span class="at">col =</span> <span class="dv">1</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>mids <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">lm</span>(y<span class="sc">~</span>x))</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mids <span class="sc">~</span> x, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">ylab =</span> <span class="st">"The line varies around the mean of y!"</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(mids)){</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(<span class="at">x =</span> <span class="fu">rep</span>(x[i], <span class="dv">2</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="fu">mean</span>(y), mids[i]))</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">at =</span> <span class="fu">mean</span>(y), <span class="at">labels =</span> <span class="fu">bquote</span>(<span class="fu">bar</span>(y)), <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="L03-Residuals_files/figure-html/R2_demo-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="residual-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="residual-assumptions">Residual Assumptions</h3>
<ul>
<li><strong>Residual</strong>: what’s left over
<ul>
<li><span class="math inline">\(\hat\epsilon_i = y_i - \hat y_i\)</span></li>
</ul></li>
<li>Assumptions:
<ul>
<li><span class="math inline">\(E(\epsilon_i) = 0\)</span></li>
<li><span class="math inline">\(V(\epsilon_i) = \sigma^2\)</span></li>
<li><span class="math inline">\(\epsilon_i \sim N(0,\sigma^2)\)</span></li>
</ul></li>
</ul>
<p>We must check our assumptions!</p>
<ul>
<li>There are statistical tests, but they’ll never tell you as much as a plot!</li>
</ul>
<p>The statistical tests try to give a p-value for the hypothesis that the residuals are normal, but looking at the residual plot will always be superior!</p>
</section>
<section id="residuals-versus-fitted-values-hatunderlineepsilon-versus-hatunderliney" class="level3">
<h3 class="anchored" data-anchor-id="residuals-versus-fitted-values-hatunderlineepsilon-versus-hatunderliney">Residuals versus <em>fitted</em> values: <span class="math inline">\(\hat{\underline\epsilon}\)</span> versus <span class="math inline">\(\hat{\underline{y}}\)</span></h3>
<div class="columns">
<div class="column" style="width:50%;">
<p>Why <span class="math inline">\(\hat{\underline{y}}\)</span> instead of <span class="math inline">\(\underline y\)</span>?</p>
<ul>
<li>See text. Try a regression of <span class="math inline">\(\hat{\underline\epsilon}\)</span> versus <span class="math inline">\(\underline{y}\)</span> yourself (mathematically and with code).</li>
</ul>
<p>Why not <span class="math inline">\(\underline x\)</span>?</p>
<ul>
<li>For simple linear regression, <span class="math inline">\(\hat{\underline{y}}\)</span> is like a unit change for <span class="math inline">\(\underline x\)</span>, so it doesn’t matter.
<ul>
<li>For multiple linear regression, it’s easier to have one variable for the <span class="math inline">\(x\)</span> axis.</li>
</ul></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell" data-hash="L03-Residuals_cache/html/resids_vs_fitted_df4246a1f2af5f92fddea67748e997a0">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> penguins[<span class="fu">complete.cases</span>(penguins),]</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(penguins) <span class="sc">+</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> body_mass_g) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">formula =</span> y<span class="sc">~</span>x) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Flipper Length (mm)"</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Body Mass (g)"</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"y versus x"</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>plm <span class="ot">&lt;-</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> flipper_length_mm, <span class="at">data =</span> penguins)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">augment</span>(plm)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(p2) <span class="sc">+</span> </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .resid) <span class="sc">+</span> </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Fitted"</span>, <span class="at">y =</span> <span class="st">"Residuals"</span>, <span class="at">title =</span> <span class="st">"Residuals versus Fitted"</span>)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">/</span> g2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="L03-Residuals_files/figure-html/resids_vs_fitted-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>I just want to add a little more context to the “unit change” idea. In a linear model, the estimated height of the line is <span class="math inline">\(\hat y_i = \hat\beta_0 + \hat\beta_1x_i\)</span>. To go from Celcius to Fahrenheit, we use the equation <span class="math inline">\(F_i = 32 + \frac{9}{5}C_i\)</span>, where <span class="math inline">\(C_i\)</span> is the Celcius value that we have and <span class="math inline">\(F_i\)</span> is the Fahrenheit value that we get. A line is literally a change of units!</p>
</section>
<section id="residual-plots-and-assumption-checking" class="level3">
<h3 class="anchored" data-anchor-id="residual-plots-and-assumption-checking">Residual Plots and Assumption Checking</h3>
<p>Mathematics is the process of making assumptions and seeing if we can break them.</p>
<ul>
<li><span class="math inline">\(E(\epsilon_i) = 0\)</span> is a given since <span class="math inline">\(\sum_{i=1}^n\hat\epsilon_i=0\)</span>.</li>
<li><span class="math inline">\(V(\epsilon_i) = \sigma^2\)</span> (regardless of <span class="math inline">\(i\)</span>)
<ul>
<li>Check if the variance looks stable.</li>
</ul></li>
<li><span class="math inline">\(\epsilon_i \sim N(0,\sigma^2)\)</span> is harder to see on a residuals versus fitted plot
<ul>
<li>Expect more points close to 0, fewer further away, no outliers</li>
</ul></li>
</ul>
</section>
<section id="residual-plots-unstable-error-a.k.a.-heteroscedasticity" class="level3">
<h3 class="anchored" data-anchor-id="residual-plots-unstable-error-a.k.a.-heteroscedasticity">Residual plots: unstable error, a.k.a. Heteroscedasticity</h3>
<div class="cell" data-hash="L03-Residuals_cache/html/heteroskedastic_ab35680f817d5848818b263156d657f1">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">200</span>, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">3</span><span class="sc">*</span>x</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y0 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> x)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y) <span class="sc">+</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y<span class="sc">~</span>x) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">"y versus x"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>xydf <span class="ot">&lt;-</span> <span class="fu">augment</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x))</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(xydf) <span class="sc">+</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .resid) <span class="sc">+</span> </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Fitted"</span>, <span class="at">y =</span> <span class="st">"Residuals"</span>, <span class="at">title =</span> <span class="st">"Residuals versus Fitted"</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">+</span> g2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="L03-Residuals_files/figure-html/heteroskedastic-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The idea of heteroscedastic data is that <span class="math inline">\(V(\epsilon_i) = \sigma^2_i\)</span>, which depends on <span class="math inline">\(i\)</span>. The most obvious case is shown above, where the variance increases along the values of <span class="math inline">\(x\)</span>. This pattern is obviously present in the plot of <span class="math inline">\(y\)</span> versus <span class="math inline">\(x\)</span>, but this can be very hard to see in higher dimensions!</p>
</section>
<section id="residual-plots-non-linear-trend" class="level3">
<h3 class="anchored" data-anchor-id="residual-plots-non-linear-trend">Residual plots: non-linear trend?</h3>
<div class="cell" data-hash="L03-Residuals_cache/html/non-linear-trend_5ce2dcbdad259944362c3ebc6089aca7">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## fig-height: 4</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">## fig-width: 8</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mtcars) <span class="sc">+</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> disp, <span class="at">y =</span> mpg) <span class="sc">+</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y<span class="sc">~</span>x) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Engine Displacement"</span>, <span class="at">y =</span> <span class="st">"Miles per Gallon"</span>, <span class="at">title =</span> <span class="st">"y versus x"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>mtdf <span class="ot">&lt;-</span> <span class="fu">augment</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> disp, <span class="at">data =</span> mtcars))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mtdf) <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .resid) <span class="sc">+</span> </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Fitted"</span>, <span class="at">y =</span> <span class="st">"Residuals"</span>, <span class="at">title =</span> <span class="st">"Residuals versus Fitted - non-linear trend?"</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">+</span> g2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="L03-Residuals_files/figure-html/non-linear-trend-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plots above show a (mild) violation of the assumption that <span class="math inline">\(y_i = \beta_0 + \beta_1x_i + \epsilon_i\)</span>, i.e., that the true trend is linear. This can be seen in the plot of <span class="math inline">\(y\)</span> against <span class="math inline">\(x\)</span>, but it’s much more obvious in the residual plot!</p>
<p>Note that, in this course, the phrase “The Residual Plot” <em>always</em> refers to a plot of residuals against fitted. There are other residual plots, but <strong>the</strong> residual plot is resids versus fitted.</p>
</section>
<section id="testing-normality-quantile-quantile-plots" class="level3">
<h3 class="anchored" data-anchor-id="testing-normality-quantile-quantile-plots">Testing Normality: Quantile-Quantile Plots</h3>
<div class="columns">
<div class="column" style="width:58%;">
<p>Consider the data (2,3,3,4,5,5,6).</p>
<ul>
<li>50% of the data is below the median.
<ul>
<li>For a <span class="math inline">\(N(0,1)\)</span> distribution, 50% of the data is below 0.</li>
<li>Put the median on the y axis, 0 on the x axis.</li>
</ul></li>
<li>25% of the data is below Q1.
<ul>
<li>For a <span class="math inline">\(N(0,1)\)</span> distribution, 25% is below <code>qnorm(0.25)</code> = -0.67</li>
<li>Put a point at x = -0.67, y = Q1.</li>
</ul></li>
<li>75% of the data is below Q3.
<ul>
<li>For a <span class="math inline">\(N(0,1)\)</span> distribution, 75% is below <code>qnorm(0.75)</code> = 0.67</li>
<li>Put a point at x = 0.67, y = Q3.</li>
</ul></li>
<li>… and so on for the rest of the quantiles
<ul>
<li>See <a href="https://colab.research.google.com/drive/1CwTYG9lx1WcSN6DDf--xSBYzgAo9PwTS">this link</a> for an example.</li>
</ul></li>
</ul>
</div><div class="column" style="width:40%;">
<p>If perfectly normal, expect a straight line!</p>
<div class="cell" data-hash="L03-Residuals_cache/html/qq-demo_ceaaeb6e5d27d4efee084ecd79de0b6f">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>quants <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fu">c</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.125</span>, <span class="fl">0.25</span>, <span class="fl">0.375</span>, <span class="fl">0.5</span>, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.625</span>, <span class="fl">0.75</span>, <span class="fl">0.875</span>))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mydata <span class="sc">~</span> quants)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="L03-Residuals_files/figure-html/qq-demo-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>The example link is a fun thing to play with! It’s written in Python, so don’t worry about the code. Change the sample sizes to get an idea of just how hard it is to definitively show that data are normal.</p>
</section>
<section id="other-residual-plots" class="level3">
<h3 class="anchored" data-anchor-id="other-residual-plots">Other Residual Plots:</h3>
<p><strong>Scale-Location</strong></p>
<ul>
<li>Scale: Standardized residual</li>
<li>Location: Fitted value</li>
<li>More on standardized residuals in Ch08</li>
</ul>
<p><strong>Cook’s Distance</strong></p>
<ul>
<li>Basically, an outlier detection method.</li>
<li>More in Ch08</li>
</ul>
<p><strong>Leverage</strong></p>
<ul>
<li>More in Ch08</li>
</ul>
</section>
</section>
<section id="maximum-likelihood" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="maximum-likelihood"><span class="header-section-number">3.4</span> Maximum Likelihood</h2>
<section id="main-idea" class="level3">
<h3 class="anchored" data-anchor-id="main-idea">Main Idea</h3>
<p>Find the values <span class="math inline">\(\hat\beta_0\)</span>, <span class="math inline">\(\hat\beta_1\)</span>, and <span class="math inline">\(\hat\sigma^2\)</span> that <strong>maximize the likelihood of seeing our data</strong>.</p>
<p>Under the assumptions that <span class="math inline">\(X\)</span> is fixed, <span class="math inline">\(Y = \beta_0 + \beta_1X + \epsilon_i\)</span>, and <span class="math inline">\(\epsilon_i\stackrel{iid}{\sim}N(0,\sigma^2)\)</span>, <span class="math display">\[
Y \sim N(\beta_0 + \beta_1X, \sigma^2)
\]</span></p>
</section>
<section id="the-likelihood" class="level3">
<h3 class="anchored" data-anchor-id="the-likelihood">The Likelihood</h3>
<p>The <strong>probability</strong> of observering a data point is: <span class="math display">\[
f_Y(y_i|x_i, \beta_0, \beta_1, \sigma^2) = \frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(\frac{-1}{2\sigma^2}(y_i - \beta_0 - \beta_1x_i)^2\right)
\]</span></p>
<p>The <strong>likelihood</strong> of the parameters, given the data, is: <span class="math display">\[
L(\beta_0, \beta_1, \sigma^2|x_i, y_i) = \prod_{i=1}^n\frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(\frac{-1}{2\sigma^2}(y_i - \beta_0 - \beta_1x_i)^2\right)
\]</span></p>
<ul>
<li>It’s just a shift in perspective!</li>
</ul>
</section>
<section id="simple-coin-flip-example" class="level3">
<h3 class="anchored" data-anchor-id="simple-coin-flip-example">Simple Coin Flip Example</h3>
<p>Suppose we flipped 10 bottle caps and got 6 “crowns”. Assume the probability of “crown” (<span class="math inline">\(C\)</span>) is unknown, labelled <span class="math inline">\(p\)</span>.</p>
<ul>
<li>The <strong>probability</strong> of one cap flip is <span class="math inline">\(P(C|p) = p\)</span>.</li>
<li>The <strong>probability</strong> of this is <span class="math inline">\(P(C = 6|p) = p^6(1-p)^4\)</span>.
<ul>
<li>This is just <span class="math inline">\(P(\underline y|p) = \prod_{i=1}^nP(Y = y_i)\)</span>.</li>
</ul></li>
<li>The <strong>likelihood</strong> is <span class="math inline">\(L(p|\underline y) = \prod_{i=1}^nP(Y = y_i)\)</span>.</li>
</ul>
</section>
<section id="maximizing-the-likelihood-in-lm" class="level3">
<h3 class="anchored" data-anchor-id="maximizing-the-likelihood-in-lm">Maximizing the Likelihood in LM</h3>
<p><span class="math display">\[
L(\beta_0, \beta_, \sigma^2) = \prod_{i=1}^n\frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(\frac{-1}{2\sigma^2}(y_i - \beta_0 - \beta_1x_i)^2\right)
\]</span></p>
<ul>
<li>To maximize w.r.t <span class="math inline">\(\beta_0\)</span>, we set the derivative w.r.t <span class="math inline">\(\beta_0\)</span> to 0 and solve for <span class="math inline">\(\beta_0\)</span>.
<ul>
<li><span class="math inline">\(\frac{\partial L(\beta_0, \beta_, \sigma^2)}{\partial \beta_0} = 0\)</span>.</li>
</ul></li>
<li>Repeat for <span class="math inline">\(\frac{\partial L(\beta_0, \beta_, \sigma^2)}{\partial \beta_1} = 0\)</span> and <span class="math inline">\(\frac{\partial L(\beta_0, \beta_, \sigma^2)}{\partial \sigma^2} = 0\)</span></li>
</ul>
<p>HWK: Show that the estimates for <span class="math inline">\(\hat\beta_0\)</span> and <span class="math inline">\(\hat\beta_1\)</span> are the same as the OLS estimates. The estimate for <span class="math inline">\(\hat\sigma^2\)</span> should come out to: <span class="math display">\[
\hat\sigma^2 = \frac{1}{n}\sum_{i=1}^n\left(y_i - \hat\beta_0 - \hat\beta_1x_i\right)^2
\]</span></p>
</section>
<section id="interpreting-the-mse" class="level3">
<h3 class="anchored" data-anchor-id="interpreting-the-mse">Interpreting the MSE</h3>
<p>The basic question of statistics: “How big is this number?”</p>
<ul>
<li>Compare to previous studies - is MSE larger than <span class="math inline">\(\sigma^2\)</span>?
<ul>
<li>Implies that Bias<span class="math inline">\(^2\)</span> and Fitted Model Variance are larger than expected.</li>
<li>F-test</li>
</ul></li>
<li>Compare to “pure error” - direct estimate of <span class="math inline">\(\sigma^2\)</span>.
<ul>
<li>i.e.&nbsp;the variance in repeated trials on the same covariate values</li>
<li>Textbooks devotes a lot to this, but it’s often not plausible.
<ul>
<li>Won’t be on tests!</li>
</ul></li>
</ul></li>
<li>Compare to another model
<ul>
<li>We’ll focus on this (later)!</li>
</ul></li>
</ul>
</section>
<section id="compare-to-previous-studies" class="level3">
<h3 class="anchored" data-anchor-id="compare-to-previous-studies">Compare to Previous Studies</h3>
<p>Hypothesis test for <span class="math inline">\(\sigma^2 = \sigma_0^2\)</span> versus <span class="math inline">\(\sigma^2 &gt; \sigma_0^2\)</span>, where <span class="math inline">\(\sigma_0\)</span> is the value from a previous study.</p>
<ul>
<li>If significant, some of your error is coming from the study design!</li>
</ul>
</section>
<section id="compare-to-other-models" class="level3">
<h3 class="anchored" data-anchor-id="compare-to-other-models">Compare to other models</h3>
<p>It can be shown that <span class="math inline">\(E(MS_{Reg}) = \sigma^2 + \beta_1S_{XX}\)</span>.</p>
<p>Consider the Null hypothesis <span class="math inline">\(\beta_1 =0\)</span> (why is this a good null?).</p>
<ul>
<li>Under this null, <span class="math inline">\(\frac{MS_{Reg}}{s^2}\sim F_{1, n-2}\)</span>.
<ul>
<li>Obvious CI from this. </li>
</ul></li>
<li>This is exactly equivalent to the t-test for <span class="math inline">\(\beta_1\)</span>! (See text.)</li>
</ul>
</section>
<section id="mse-of-a-parameter-bias-of-s2" class="level3">
<h3 class="anchored" data-anchor-id="mse-of-a-parameter-bias-of-s2">MSE of a Parameter: Bias of <span class="math inline">\(s^2\)</span></h3>
<p>From a previous class, we know that <span class="math display">\[
\frac{(n-2)s^2}{\sigma^2}\sim\chi^2_{n-2}
\]</span></p>
<p>From wikipedia, we know that the mean of a <span class="math inline">\(\chi^2_k\)</span> distribution is <span class="math inline">\(k\)</span>. Therefore, <span class="math display">\[
E\left(\frac{(n-2)s^2}{\sigma^2}\right) = n-2 \Leftrightarrow E(s^2) = \sigma^2
\]</span> and thus <span class="math inline">\(s^2\)</span> is unbiased.</p>
<p>This does <em>not necessarily</em> mean that <span class="math inline">\(s^2\)</span> is the best estimator for <span class="math inline">\(\sigma^2\)</span>!</p>
</section>
<section id="mse-of-a-parameter-bias-of-s" class="level3">
<h3 class="anchored" data-anchor-id="mse-of-a-parameter-bias-of-s">MSE of a Parameter: Bias of <span class="math inline">\(s\)</span></h3>
<p>Even though <span class="math inline">\(s^2\)</span> is an unbiased estimator, <span class="math inline">\(s = \sqrt{s^2}\)</span> is biased! Specifically, <span class="math inline">\(E(s) &lt; \sigma\)</span></p>
<p>To see why, first note that <span class="math display">\[
V(s) = E(s^2) - (E(s))^2 \Leftrightarrow E(s) = \sqrt{E(s^2) - V(s)}
\]</span> since <span class="math inline">\(V(s) &gt; 0\)</span>, <span class="math inline">\(E(s^2) - V(s) &lt; E(s^2)\)</span>, and therefore <span class="math display">\[
E(s) &lt; \sqrt{E(s^2)} = \sqrt{\sigma^2} = \sigma
\]</span></p>
</section>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<ul>
<li>Most of regression involves <strong>analysing the residuals</strong>.
<ul>
<li>Residuals <strong>are</strong> regression.</li>
<li>Residual plots will all be explained/explored thoroughly.</li>
</ul></li>
<li><span class="math inline">\(R^2 = \frac{SSReg}{SST}\)</span> is the <strong>percent of variance explained</strong>.
<ul>
<li>This is a very important concept.</li>
</ul></li>
<li>MLE usually involves writing out a product of normals
<ul>
<li>Take the <code>ln()</code>, then derivative, then set to 0 and solve.</li>
</ul></li>
<li>The MSE is best interpreted relative to a hypothesis or other model.
<ul>
<li>The raw value is sometimes - but rarely - useful.</li>
</ul></li>
</ul>
</section>
</section>
<section id="exercises" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="exercises"><span class="header-section-number">3.5</span> Exercises</h2>
<p>Recommended textbook exercises: A, C, E, F, H, I, J, O, P, W</p>
<details>
<summary>
<strong>Solution to A</strong>
</summary>
<div class="cell" data-hash="L03-Residuals_cache/html/dse03a-1_d2e80eba46f91a8616795bfd1f1f6b2f">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aprean3) <span class="co"># install.packages("aprean3")</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(dse03a)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dse03a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   x  y
1 -5  1
2 -4  5
3 -3  4
4 -2  7
5 -1 10
6  0  8</code></pre>
</div>
</div>
<div class="cell" data-hash="L03-Residuals_cache/html/dse03a-2_3ed6c863a8e2bc87664308c3038b9509">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># part 1</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> dse03a) <span class="sc">|&gt;</span> <span class="fu">coef</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)           x 
   9.272727    1.436364 </code></pre>
</div>
</div>
<p>The prediction equation is <span class="math display">\[
\hat y_i = \hat\beta_0 + \hat\beta_1x_i =  9.27 + 1.436 * x_i
\]</span></p>
<div class="cell" data-hash="L03-Residuals_cache/html/dse03a-3_2da295acf7170903e52eed10e251ee8d">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># part 2</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> dse03a) <span class="sc">|&gt;</span> <span class="fu">anova</span>() <span class="co"># Reject the null, beta_1 is sig. diff. from 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: y
          Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
x          1 226.945  226.94   96.18 4.207e-06 ***
Residuals  9  21.236    2.36                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># part 3</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>e3lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> dse03a)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, dse03a<span class="sc">$</span>x)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>XTX1 <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> XTX1 <span class="sc">%*%</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> dse03a<span class="sc">$</span>y</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dse03a) <span class="sc">-</span> <span class="dv">2</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> X <span class="sc">%*%</span> betas</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>((dse03a<span class="sc">$</span>y <span class="sc">-</span> preds)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> df)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>XTX <span class="ot">&lt;-</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> X</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>betas[<span class="dv">2</span>] <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>) <span class="sc">*</span> <span class="fu">qt</span>(<span class="fl">0.025</span>, <span class="at">df =</span> df) <span class="sc">*</span> s <span class="sc">/</span> <span class="fu">sqrt</span>(XTX[<span class="dv">2</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.105045 1.767682</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(e3lm) <span class="co"># check that it's correct</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               2.5 %    97.5 %
(Intercept) 8.225007 10.320447
x           1.105045  1.767682</code></pre>
</div>
</div>
<hr>
</details>
<ol type="1">
<li>Show that <span class="math inline">\(E(MS_{Reg}) = \sigma^2 + \beta_1^2\sum_{i=1}^n(x_i-\bar x)^2\)</span>. *Hint: <span class="math inline">\(V(y_i) = E(y_i^2) - E(y_i)^2\)</span>, and you’ll need to plug in the estimates for <span class="math inline">\(\hat\beta_0\)</span> and <span class="math inline">\(\hat\beta_1\)</span>.</li>
<li>Use R to calculate the values in the ANOVA table, i.e.&nbsp;the “Sum of Squares” section, for a linear regression of <code>waiting</code> versus <code>eruptions</code> in the <code>faithful</code> data. Compare the the <code>anova()</code> output, shown below.</li>
</ol>
<div class="cell" data-hash="L03-Residuals_cache/html/faithful-anova_b7643f3c545429791b225a4f1ef1254a">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(faithful)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> faithful<span class="sc">$</span>waiting</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>y_bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>faithful_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(waiting <span class="sc">~</span> eruptions, <span class="at">data =</span> faithful)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(faithful_lm)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(faithful_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: waiting
           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
eruptions   1  40644   40644  1162.1 &lt; 2.2e-16 ***
Residuals 270   9443      35                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Use a simulation to demonstrate that, assuming <span class="math inline">\(\beta_1 = 0\)</span>, <span class="math inline">\(MS_{Reg} / MS_E \sim F_{df_{Reg}, df_E}\)</span>.
<ul>
<li>Explain why this is only true when <span class="math inline">\(\beta_1 = 0\)</span>?</li>
</ul></li>
</ol>
<details>
<summary>
<strong>Solution</strong>
</summary>
<div class="cell" data-hash="L03-Residuals_cache/html/dist_msreg_0679398d639c8f2e62fc7fc419433ed4">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>f_vals <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>msreg_vals <span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    e <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">+</span> <span class="fl">0.005</span><span class="sc">*</span>x <span class="sc">+</span> e</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    mylm <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    y_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(mylm)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    y_bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    ms_reg <span class="ot">&lt;-</span> <span class="fu">sum</span>((y_hat <span class="sc">-</span> y_bar)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="dv">1</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    msreg_vals[i] <span class="ot">&lt;-</span> ms_reg</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    ms_e <span class="ot">&lt;-</span> <span class="fu">sum</span>((y <span class="sc">-</span> y_hat)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (n <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    f_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(f_vals, ms_reg <span class="sc">/</span> ms_e)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(f_vals, <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">breaks =</span> <span class="dv">40</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">df</span>(x, <span class="dv">1</span>, n <span class="sc">-</span> <span class="dv">2</span>), <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="L03-Residuals_files/figure-html/dist_msreg-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Why is this only true when <span class="math inline">\(\beta_1=0\)</span>? For intuition, this only <em>should</em> be true when the null is true: recall that p-values are always calculated <em>assuming that the null is true</em>, and the F-stat is no different.</p>
<p>Mathematically, this has to do with the fact that <span class="math inline">\(E(MS_{Reg}) = \sigma^2 + \beta_1S_{XX}\)</span>, not just <span class="math inline">\(\sigma^2\)</span>. Since this is not equal to <span class="math inline">\(\sigma^2\)</span>, this does not follow a Chi-Square distribution.</p>
<div class="cell" data-hash="L03-Residuals_cache/html/dist-msreg-2_b23d169dbb0d78cf295dc008693467a4">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(msreg_vals, <span class="at">breaks =</span> <span class="dv">40</span>, <span class="at">freq =</span> <span class="cn">FALSE</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dchisq</span>(x, <span class="dv">1</span>), <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># qqplot, just to check</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">qqplot</span>(<span class="at">x =</span> <span class="fu">qchisq</span>(<span class="fu">ppoints</span>(<span class="fu">length</span>(msreg_vals)), <span class="dv">1</span>), <span class="at">y =</span> msreg_vals)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="L03-Residuals_files/figure-html/dist-msreg-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
… actually it kinda does follow a Chi-Square distribution. Not sure what to make of that.
</details>
<hr>
<ol start="4" type="1">
<li>Show that <span class="math inline">\(\frac{SSReg}{SST} = \frac{S_{XY}^2}{S_{XX}S_{YY}}\)</span>.</li>
<li>Explore why we use residuals versus fitted, rather than residuals versus observed.
<ul>
<li>Fit a regression, then plot <span class="math inline">\(\underline\epsilon\)</span> versus <span class="math inline">\(\underline y\)</span>. What do you notice?</li>
<li>Find <span class="math inline">\(cor(\epsilon_i, y_i)\)</span> mathematically. Compare this with what you see in the plot.</li>
</ul></li>
</ol>
<details>
<summary>
<strong>Solution</strong>
</summary>
<div class="cell" data-hash="L03-Residuals_cache/html/resids-vs-observed_69ace0350264f73c5342c1dffc2f553a">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x <span class="sc">+</span> e</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>mylm <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mylm<span class="sc">$</span>residuals <span class="sc">~</span> y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="L03-Residuals_files/figure-html/resids-vs-observed-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that <span class="math inline">\(y_i = \hat y_i + \hat \epsilon_i\)</span></p>
<p><span class="math display">\[
cov(\hat\epsilon_i, y_i) = cov(\epsilon_i, \hat y_i + \hat \epsilon_i) = cov(\epsilon_i, \hat y_i) + cov(\hat\epsilon_i, \hat \epsilon_i) = 0 + \sigma^2
\]</span></p>
<p>Empiricially:</p>
<div class="cell" data-hash="L03-Residuals_cache/html/var-covar-resids_92a0339f0ea7f6b6382583ea7a8b690b">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(mylm<span class="sc">$</span>residuals, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.987392</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(mylm<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.987392</code></pre>
</div>
</div>
<p>This is why we use residuals versus fitted, not residuals versus observed!</p>
</details>
<hr>
<ol start="6" type="1">
<li><p>Show that the estimates for <span class="math inline">\(\hat\beta_0\)</span> and <span class="math inline">\(\hat\beta_1\)</span> are the same as the OLS estimates.</p></li>
<li><p>Find the MLE estimate for <span class="math inline">\(\sigma^2\)</span>.</p>
<ul>
<li>Comment on the difference between this formula and the usual variance formula.</li>
<li>Comment on the variance formula from least squares</li>
</ul></li>
</ol>
<details>
<summary>
<strong>Solution</strong>
</summary>
<p>Derivation left as an exercise. Hint: You are allowed to take a derivative with respect to <span class="math inline">\(\sigma^2\)</span>, not just <span class="math inline">\(\sigma\)</span>.</p>
<ul>
<li>MLE versus usual formula: We’re dividing by <span class="math inline">\(n\)</span>, not <span class="math inline">\(n - 1\)</span> or even <span class="math inline">\(n - 2\)</span>! The mle is actually <strong>biased</strong>. We’ll explore this in the next question.</li>
<li>There is no variance formula in least squares! MLE allows us to incorporate our assumption about the distribution of the residuals, giving us more to work with!</li>
</ul>
</details>
<hr>
<ol start="8" type="1">
<li>The MLE of <span class="math inline">\(\sigma^2\)</span> divides by <span class="math inline">\(n\)</span>. Demonstrate via simulation that this is actually a biased estimate.</li>
</ol>
<details>
<summary>
<strong>Solution</strong>
</summary>
<div class="cell" data-hash="L03-Residuals_cache/html/mle_bias_1_4931221beef6705eaf34db643b36a2b2">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>true_sigma <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>n_minus <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>vals <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(n_minus), <span class="at">nrow =</span> <span class="dv">10000</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>) {</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, true_sigma)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    vals[i, ] <span class="ot">&lt;-</span> <span class="fu">sum</span>((y <span class="sc">-</span> <span class="fu">mean</span>(y))<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (n <span class="sc">-</span> n_minus)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(vals, <span class="dv">2</span>, mean) <span class="sc">|&gt;</span> <span class="fu">plot</span>(<span class="at">x =</span> n_minus, <span class="at">y =</span> _)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> true_sigma<span class="sc">^</span><span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="L03-Residuals_files/figure-html/mle_bias_1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the plot, we get closest to the true value when we subtract 1 from <span class="math inline">\(n\)</span>. However, the MLE subtracts nothing from <span class="math inline">\(n\)</span>! Why not? Let’s check the MSE.</p>
<div class="cell" data-hash="L03-Residuals_cache/html/mle_bias_2_3367ebec4e6d6301f070aa52e073ca2e">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(vals, <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>((x <span class="sc">-</span> true_sigma<span class="sc">^</span><span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> <span class="fu">plot</span>(<span class="at">x =</span> n_minus, <span class="at">y =</span> _)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="L03-Residuals_files/figure-html/mle_bias_2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The MSE is lowest when we divide by… <span class="math inline">\(n+1\)</span>???? Yes, this is just how it is. See <a href="https://alemorales.info/post/variance-estimators/">here</a> for a bit more discussion on this issue. Basically, the estimator with <span class="math inline">\(n-1\)</span> is unbiased, and <span class="math inline">\(n\)</span> is lower variance without too much bias, while <span class="math inline">\(n+1\)</span> is much more bias than we’re comfortable with.</p>
</details>
<hr>
<ol start="9" type="1">
<li>Prove that <span class="math inline">\(\sum_i=1^n\hat\epsilon_i = 0\)</span>. Really try it yourself, then check the hint below only if your’re struggling.</li>
</ol>
<details>
<summary>
<strong>Hint</strong>
</summary>
<span class="math inline">\(\hat\epsilon_i = y_i - \hat\beta_0 - \hat\beta_1x_i\)</span>, <span class="math inline">\(\sum_{i=1}^ny_i = n\bar y\)</span>, and <span class="math inline">\(\beta_0 = \bar y - \hat\beta_1x_i\)</span>. *****
</details>
<ol start="10" type="1">
<li>Consider the following plot, where the grey line is the mean model (where <span class="math inline">\(\beta_1 = 0\)</span>), the green line represents the simple linear regression of mpg versus displacement, and the red line represents a model where the intercept is forced to be 0 (I use this a lot because it’s easy to conceptualize and the math is easy, <em>not</em> because it’s usually relevant to applications). Using R, calculate the anova table for both models and interpret the results.</li>
</ol>
<div class="cell" data-hash="L03-Residuals_cache/html/no-intercept_143054e6dfa4323d78efbb685f7865ff">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars) <span class="sc">+</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> disp, <span class="at">y =</span> mpg) <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"darkgrey"</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">colour =</span> <span class="st">"green"</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> x, <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="L03-Residuals_files/figure-html/no-intercept-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model with an intercept (the usual model)</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>lm_with <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> disp, <span class="at">data =</span> mtcars)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Using "0 +" forces the intercept to be 0</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>lm_without <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> disp, <span class="at">data =</span> mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
<strong>Solution</strong>
</summary>
<div class="cell" data-hash="L03-Residuals_cache/html/no-intercept-solution_e994c442e142700455be1456f31d1043">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lm_with)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: mpg
          Df Sum Sq Mean Sq F value   Pr(&gt;F)    
disp       1 808.89  808.89  76.513 9.38e-10 ***
Residuals 30 317.16   10.57                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lm_without)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: mpg
          Df Sum Sq Mean Sq F value    Pr(&gt;F)    
disp       1 7599.9  7599.9   36.57 1.073e-06 ***
Residuals 31 6442.4   207.8                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Some interpretations:</p>
<ul>
<li>For <code>lm_with</code>:
<ul>
<li><span class="math inline">\(MS_{Reg} = 808.89\)</span> and <span class="math inline">\(MS_E = 10.57\)</span>, which are clearly different numbers (even with a sample size of 32, which you can see from <span class="math inline">\(df_E = 30 = n - 2\)</span>).
<ul>
<li>The model is clearly different from just using the mean!</li>
<li>The p-value confirms this.</li>
</ul></li>
</ul></li>
<li>For <code>lm_without</code>:
<ul>
<li>Again, the model is clearly “different” from just using the mean, but it’s not necessarily <strong>better</strong> than using it. The graph shows that this model fits very poorly, the variance is just significantly <em>different</em>!</li>
<li>Note that the degrees of freedom is <span class="math inline">\(n - 1\)</span>, since we’re only estimating one parameter (the slope).</li>
</ul></li>
<li>Comparison:
<ul>
<li><span class="math inline">\(MS_{E}^{(with)} = 10.57\)</span> and <span class="math inline">\(MS_E^{(without)} = 207.8\)</span>. Clearly the model with an intercept is fitting much much better!
<ul>
<li>Notice: we did not look at <span class="math inline">\(MS_{E}^{(with)} = 10.57\)</span> and conclude that it was clearly a small value. The MSE is really hard to interpret on it’s own, but it’s quite useful for comparisons!</li>
</ul></li>
</ul></li>
</ul>
</details>
<hr>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./L02-Fitting_Straight_Lines.html" class="pagination-link" aria-label="Fitting Straight Lines">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fitting Straight Lines</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./L04-Matrix_Form.html" class="pagination-link" aria-label="Regression in Matrix Form">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regression in Matrix Form</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright Devan Becker, released under Creative Commons Attribution-ShareAlike 4.0.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>